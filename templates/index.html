<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>SOValidator</title>
</head>
<body>
  <h1>SOValidator</h1>

  <form method="post" enctype="multipart/form-data">
    <label>PDF mit eingebetteter XML hochladen:</label>
    <input type="file" name="pdf_file" required>
    <button type="submit">Prüfen</button>
  </form>

  {% if result %}
    <h3>Ergebnis</h3>
    <p>{{ result|safe }}</p>
  {% endif %}

  {% if codelist_table %}
    <h3>Codelistenverletzungen</h3>
    <form method="post">
      <input type="hidden" name="raw_xml" value="{{ raw_xml|tojson }}">
      <input type="hidden" name="raw_table" value="{{ raw_table|tojson }}">
      <table border="1" cellpadding="6">
        <thead>
          <tr>
            <th>Feld</th>
            <th>Wert</th>
            <th>Zeile</th>
            <th>Vorschlag</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in codelist_table %}
            <tr>
              <td>{{ entry.label }}</td>
              <td>{{ entry.value }}</td>
              <td>{{ entry.line }}</td>
              <td>
                {% if entry.suggestion %}
                  {{ entry.suggestion }}
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <br>
      <button type="submit" name="fix_all" value="1">✔ Alle Vorschläge übernehmen</button>
    </form>
  {% endif %}

  {% if corrected_xml %}
    <h3>Korrigiertes XML (Ausschnitt)</h3>
    <pre style="max-height: 400px; overflow: auto;">{{ corrected_xml|e }}</pre>
  {% endif %}
</body>
</html>
