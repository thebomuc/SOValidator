<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>SOValidator</title>
</head>
<body>
  <h1>SOValidator</h1>

  <form method="post" enctype="multipart/form-data">
    <label>PDF mit eingebetteter XML hochladen:</label>
    <input type="file" name="pdf_file" required>
    <button type="submit">PrÃ¼fen</button>
  </form>

  {% if result %}
    <h3>Ergebnis</h3>
    <p>{{ result|safe }}</p>
  {% endif %}

  {% if codelist_table %}
    <h3>Codelistenverletzungen</h3>
    <form method="post">
      <!-- WICHTIG: tojson + safe -->
      <input type="hidden" name="raw_xml" value='{{ raw_xml | tojson | safe }}'>
      <input type="hidden" name="raw_table" value='{{ raw_table | tojson | safe }}'>

      <table border="1" cellpadding="6">
        <thead>
          <tr>
            <th>Feld</th>
            <th>Wert</th>
            <th>Zeile</th>
            <th>Vorschlag</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in codelist_table %}
            <tr>
              <td>{{ entry.label }}</td>
              <td>{{ entry.value }}</td>
              <td>{{ entry.line }}</td>
              <td>
                {% if entry.suggestion %}
                  {{ entry.suggestion }}
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <br>
      <button type="submit" name="fix_all" value="1">âœ” Alle VorschlÃ¤ge Ã¼bernehmen</button>
    </form>
  {% endif %}

  {% if show_download %}
    <h3>Neue korrigierte PDF</h3>
    <p><a href="{{ url_for('download') }}" download>ðŸ“„ Korrigierte PDF herunterladen</a></p>
  {% endif %}
</body>
</html>
